---
title: API Gateway 설치
description: API Gateway 개념을 공부해봅시다.
author: melonhong
date: '2025-11-22 23:29:08 +0900'
categories:
- rooton
tags: []
---

## 개요

우리 서비스는 **MSA(Microservices Architecture) 기반**이며 **JWT 기반 토큰 인증**을 사용합니다.

서비스 도메인은 다음과 같이 나뉩니다.
* `auth`: JWT 인증, 회원가입 및 로그인
* `user`: 사용자 등록 및 정보 관리
* `task`: 할 일 도메인
* `appointment`: 약속 도메인

### 문제 제기

MSA 환경에서 JWT 인증을 `auth` 서비스가 담당할 때, 다른 서비스(`user`, `task`, `appointment` 등)로 들어온 요청을 어떻게 인증할 것인가가 문제입니다.

1.  **각 서비스가 `auth`에 인증 요청:** `user` 서비스가 `auth` 서비스에 요청을 보내 JWT 인증을 요청하는 방식.
    * **문제점:** 네트워크 부하 증가.
2.  **각 서비스마다 JWT 인증 필터 설치:**
    * **문제점:** 확장성 저하 (도메인 서비스 추가 시마다 필터 추가 필요), 서비스 무거워짐, MSA 취지에 맞지 않음 (인증을 한 서비스가 담당하지 않음).

### 해결책: 게이트웨이 도입

결국 모든 요청을 한 번 검수하는 **'검문소'**, 즉 **게이트웨이**가 필요합니다. 게이트웨이는 도메인 서비스와는 구분되는 **인프라/플랫폼 성격의 서비스**입니다.


## 게이트웨이 (Gateway)

**게이트웨이:** 서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능하게 하는 컴퓨터나 소프트웨어. **다른 네트워크로 들어가는 관문(입구)** 역할을 합니다.

> **⚠️ 라우터 vs 게이트웨이**
> * **라우터:** Layer3 계층의 특정 장비.
> * **게이트웨이:** 특정 계층에 속하지 않으며, 다양한 네트워크 통신에서 다리 역할을 하는 **개념**에 가깝습니다.


## API 게이트웨이 (API Gateway)

**API 게이트웨이:** 클라이언트와 서버 사이에 위치하며, **API 호출을 위한 단일 진입점(Single Entry Point)**을 제공합니다. 
API 게이트웨이는 다음과 같은 핵심 역할을 수행합니다.

* **보안 정책:** 인증, 권한 부여, 액세스 제어 및 암호화.
* **라우팅 정책:** 라우팅, 부하 분산(Load Balancing), 속도 제한, 요청/응답 조작.
* **관찰 정책:** 실시간/과거 메트릭, 로깅 및 추적.

즉, API 요청을 수신하여 다른 서비스로 **라우팅**하고, 애플리케이션에 대한 **보안 및 분석 기능**을 제공하는 계층입니다.


## API 게이트웨이 구현 방법

우리 서비스에서 API 게이트웨이가 해야 할 역할은 **JWT 인증, 라우팅, 로드밸런싱**입니다.

### 1. Spring Cloud Gateway

Spring Boot에서 제공하는 API 게이트웨이입니다. 빠르고 편리하게 구축 가능합니다.

* **JWT 인증:** **Spring Security**와 필터링 사용
* **라우팅:** `application.yml` 파일로 설정
* **로드밸런싱:** **Spring Cloud LoadBalancer** 사용

### 2. Kubernetes Ingress

Kubernetes의 Ingress를 사용하여 게이트웨이를 구축할 수 있습니다.

* **JWT 인증:** 기본 기능 없음.
    * **해결 방법:** (1) JWT 검증은 **Spring Cloud Gateway** 또는 **각 서비스**에서 수행, (2) Ingress Controller 플러그인/모듈 활용 (복잡).
* **라우팅:** YAML 파일로 설정
* **로드밸런싱:** 기본적으로 요청을 로드밸런싱함 (**RR 방식**).

### 3. 클라우드 플랫폼 제공 API 게이트웨이

Amazon(AWS), GCP 등의 클라우드 플랫폼에서 제공하는 서비스를 사용합니다. 설정 방법과 가격이 플랫폼마다 상이합니다.

### 결론 및 선택

개발 현황, 배포 일정, 현재 코드를 고려하여 **Spring Cloud Gateway**로 API 게이트웨이를 구현하는 것이 적합하다고 판단했습니다.

정식 배포 환경에서는 두 가지 방법을 혼용할 수 있습니다.

> **[Client] → [Ingress] → [API Gateway (Spring Cloud Gateway 등)] → [각 서비스]**

이 구조에서 인그레스는 외부 요청을 클러스터 안으로 가져와 API 게이트웨이로 부하분산하고, API 게이트웨이는 검증된 요청을 다시 각 서비스로 부하분산합니다.


## 원글
[API Gateway 설치](https://readinging.tistory.com/10)