---
title: 스프링 부트3 제 18장
description: |
    댓글 수정, 웹 페이지에서 바로 가능? ㅇㅇ 가능!
author: melonhong
date: '2025-03-07 14:47:43 +0900'
categories:
- 스프링 부트3
tags: []
---
## 모달(modal)이란?
웹 페이지에서 새 창을 띄우는 팝업 창과 달리 같은 웹 페이지 내부에서 상위 레이어를 띄우는 방식으로 사용하는 창이다. 여기선 댓글 수정 화면을 모달 창으로 만들고, 자바스크립트로 REST API를 호출하여 수정 기능을 구현했다.


## 뷰 페이지
### comments/_list.mustache
```html
{% raw %}
<div class="card m-2" id="comments-list">
    {{#commentDtos}}
        <div id="comments-{{id}}" class="card m">
            <div class="card-header">
                {{nickname}}
                <!-- 댓글 수정 버튼 -->
                <button type="button"
                        class="btn btn-sm btn-outline-primary"
                        data-bs-toggle="modal"
                        data-bs-target="#comment-edit-modal"
                        data-bs-id="{{id}}"
                        data-bs-nickname="{{nickname}}"
                        data-bs-body="{{body}}"
                        data-bs-article-id="{{articleId}}">수정</button>
                <!-- 댓글 수정 Modal -->
                <div class="modal fade" id="comment-edit-modal" tabindex="-1"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">댓글 수정</h1>
                                <button type="button" class="btn-close"
                                        data-bs-dismiss="modal" aria-label="Close"
                                ></button>
                            </div>
                            <div class="modal-body">
                                <!-- 댓글 수정 폼 -->
                                <form>
                                    <!-- 닉네임 입력 -->
                                    <div class="mb-3">
                                        <label for="edit-comment-nickname" class="form-label">닉네임</label>
                                        <input type="text" class="form-control" id="edit-comment-nickname">
                                    </div>
                                    <!-- 내용 입력 -->
                                    <div class="mb-3">
                                        <label for="edit-comment-body" class="form-label">내용</label>
                                        <textarea type="text" rows="3" class="form-control" id="edit-comment-body"></textarea>
                                    </div>
                                    <!-- 히든 인풋(부모 게시글의 id) -->
                                    <input type="hidden" id="edit-comment-article-id">
                                    <input type="hidden" id="edit-comment-id">
                                    <!-- 전송 버튼 -->
                                    <button type="button" class="btn btn-primary" id="comment-update-btn">수정 완료</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                {{body}}
            </div>
        </div>
    {{/commentDtos}}
</div>
<!-- modal 이벤트 처리-->
<script>
    {
        const commentEditModal = document.querySelector("#comment-edit-modal");
        commentEditModal.addEventListener("show.bs.modal", (event) => { // 모달이 표시되기 직전 실행되는 이벤트
            // 1. 트리거 버튼 선택
            const triggerBtn = event.relatedTarget;

            // 2. 데이터 가져오기
            const id = triggerBtn.getAttribute("data-bs-id");
            const nickname = triggerBtn.getAttribute("data-bs-nickname");
            const body = triggerBtn.getAttribute("data-bs-body");
            const articleId = triggerBtn.getAttribute("data-bs-article-id");

            // 3. 수정 폼에 데이터 삽입
            document.querySelector("#edit-comment-nickname").value = nickname;
            document.querySelector("#edit-comment-body").value = body;
            document.querySelector("#edit-comment-id").value = id;
            document.querySelector("#edit-comment-article-id").value = articleId;
        });
    }
    {
        // REST API 호출하기
        const commentUpdateBtn = document.querySelector("#comment-update-btn");
        commentUpdateBtn.addEventListener("click", () => {
            const comment = {
                id: document.querySelector("#edit-comment-id").value, // 댓글의 아이디
                nickname: document.querySelector("#edit-comment-nickname").value, // 댓글의 닉네임
                body: document.querySelector("#edit-comment-body").value, // 댓글의 본문
                articleId: document.querySelector("#edit-comment-article-id").value, // 부모 게시글의 id
            };
            console.log(comment);

            // fetch(): 비동기 통신을 위한 API
            const url = "/api/comments/" + comment.id;
            fetch(url, {
            method: "PATCH",
            headers: {
                "Content-Type": "application/json", // 전송 본문의 데이터 타입 정보(JSON)
            },
            body: JSON.stringify(comment) // comment 객체를 JSON 문자열로 변환해 전송
            }).then(response => {
            // HTTP 응답 코드에 따른 메시지 출력
            const msg = (response.ok) ? "댓글이 수정됐습니다" : "댓글 수정 실패";
            alert(msg);
            // 페이지 새로 고침
            window.location.reload();
            });
        });
    }
</script>
{% endraw %}
```
modal 코드는 Bootstrap에서 가져왔다.  

모달 트리거 버튼에 `data-*` 속성을 추가하여 데이터를 모달로 전달했다. 이 데이터는 자바스크립트에서 `getAttribute()` 메서드로 가져왔다.  

`show.bs.modal`은 모달이 보여지기 직전 일어나는 이벤트이다. 더 다양한 이벤트가 존재한다.  

댓글 수정 폼은 `_new.mustache`의 작성 폼을 가져온 걸 수정했다. `fetch()` 메서드도 가져와서 수정했다.